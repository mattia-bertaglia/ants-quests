<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="/bootstrap/bootstrap-table.min.css">
    <link rel="icon" type="image/x-icon" href="/img/RAD_Favicon.webp">
    <title>Esiti</title>
</head>
<body>

    <br>
    <nav></nav>
    
    <div class="container">
        <div class="row">
            <div class="col">
                <div class="card">
                    <div class="card-header">
                        <h5>Filtri Ricerca</h5>
                    </div>
                    <div class="card-body">
    
                    <form action="esiti" method="get">
    
                        <div class="form-group" >
                            <label for="">Titolo</label><br>
                            <select style="padding: 10px; width: 30%;" id="mySel" onchange="changeVisibility(this)">
                                <option disabled="" selected=""> -Selezione un elemento- </option>
                                <option th:each="alltitoli : ${listaQuestionari}" th:text="${alltitoli.titolo}" th:value="${alltitoli.titolo}"></option>
                                
                            </select>
                        </div>


                        <div>

                            <label for="">Categoria</label><br>
                            <select name="type" style="padding: 10px; width: 30%;" onchange="changeVisibilityCat(this)">
                                <option disabled="" selected=""> -Selezione un elemento- </option>
                                <option th:each="categorie : ${listaCategorie}" th:text="${categorie.nome}" th:value="${categorie.nome}"></option>
                            </select>
                        </div>


                        <div class="form-group">
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="data_inizio">Data Inizio</label>
                                    <input type="date" id="data_inizio" name="data_inizio" class="form-control">
                                </div>
                                <div class="col-md-6">
                                    <label for="data_fine">Data Fine</label>
                                    <input type="date" id="data_fine" name="data_fine" class="form-control">
                                </div>
                            </div>
                        </div>
    
                        <div class="form-group">
                            <label for="area">Utente</label>
                            <input type="text" onkeyup="myFunction()" id="stringa" name="area" class="form-control" placeholder="Nome e Cognome"><br>
                        </div>
                        
                        <div class="form-group text-center">
                        <button type="button" class="btn btn-primary  w-75" onclick="changeVisibilityDate()">Cerca</button>
                        </div>
    
                    </form>
    
                    </div>
                </div>
            </div>
        </div>
    
        <br>
    
        <div class="row">
            <div class="col">
                <div class="card">
                    <div class="card-header">
    
                        <div class="row">
                            <div class="col-md-2">
                                <h5>Elenco Questionari</h5>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <form action="esiti" method="get">
                            <table id="myTable" class="table table-striped table-bordered table-sm" style="width: 100%;" data-toggle="table" data-locale="it-IT">
                                <thead>
                                    <tr>
                                        <th>Categoria</th>
                                        <th>Titolo</th>
                                        <th>Data</th>
                                        <th>Punteggio</th>
                                        <th>Tempo</th>
                                        <th>Utente</th>
                                        <th class="text-center">Questionario</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="questionari : ${listaEsitiQuestionari}">
                                        <td th:text="${questionari.Quest.categoriequest.nome}"></td>
                                        <td th:text="${questionari.Quest.titolo}"></td>
                                        <td th:text="${questionari.dataEsecuzione}"></td>
                                        <td th:text="${questionari.punteggio}"></td>
                                        <td th:text="${questionari.tempo}"></td>
                                        <td th:text="|${questionari.studente.nome} ${questionari.studente.cognome}|"></td>
                                        <td class="text-center"><button name="id_quest" type="submit" class="btn btn-primary w-75" th:value="${questionari.idEstQst}">Vedi</button></td>
                                    </tr> 
                                    <tr th:if="${#lists.isEmpty(listaEsitiQuestionari)}">
                                        <td class="text-center" colspan="7">Nessun Elemento</td>
                                    </tr>
                                </tbody>
                            </table>
                            <a onclick="prevPage()" href = "#" id="btn_prev">Prev</a>
                            <a onclick="nextPage()" href="#" id="btn_next">Next</a>
                            page: <span id="page"></span>
                        </form>  
                </div>
            </div>
        </div>
    </div>
    </div>
    
        <script>
function myFunction() {
  var input, filter, table, tr, td, i, txtValue;
  input = document.getElementById("stringa");
  filter = input.value.toUpperCase();
  table = document.getElementById("myTable");
  tr = table.getElementsByTagName("tr");
  for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[5];
    if (td) {
      txtValue = td.textContent || td.innerText;
      if (txtValue.toUpperCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }       
  }
}

function changeVisibility(e){
    
    table = document.getElementById("myTable");
    tr = table.getElementsByTagName("tr");

    for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[1];
    if (td) {
        txtValue = td.textContent || td.innerText;
      if (txtValue.indexOf(e.value) > -1) {

        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }       
  }
}

function changeVisibilityCat(e){
    
    table = document.getElementById("myTable");
    tr = table.getElementsByTagName("tr");

    for (i = 0; i < tr.length; i++) {
    td = tr[i].getElementsByTagName("td")[0];
    if (td) {
        txtValue = td.textContent || td.innerText;
      if (txtValue.indexOf(e.value) > -1) {

        tr[i].style.display = "";
      } else {
        tr[i].style.display = "none";
      }
    }       
  }
}



var current_page = 1;
var records_per_page = 10;
var l = document.getElementById("myTable").rows.length

function prevPage()
{

    if (current_page > 1) {
        current_page--;
        changePage(current_page);
    }
}

function nextPage()
{
    if (current_page < numPages()) {
        current_page++;
        changePage(current_page);
    }
}
    
function changePage(page)
{
    var btn_next = document.getElementById("btn_next");
    var btn_prev = document.getElementById("btn_prev");
    var listing_table = document.getElementById("myTable");
    var page_span = document.getElementById("page");
 
    // Validate page
    if (page < 1) page = 1;
    if (page > numPages()) page = numPages();

    [...listing_table.getElementsByTagName('tr')].forEach((tr)=>{
        tr.style.display='none'; // reset all to not display
    });
    listing_table.rows[0].style.display = ""; // display the title row

    for (var i = (page-1) * records_per_page + 1; i < (page * records_per_page) + 1; i++) {
        if (listing_table.rows[i]) {
            listing_table.rows[i].style.display = ""
        } else {
            continue;
        }
    }
    
    page_span.innerHTML = page + "/" + numPages();

    if (page == 1) {
        btn_prev.style.visibility = "hidden";
    } else {
        btn_prev.style.visibility = "visible";
    }

    if (page == numPages()) {
        btn_next.style.visibility = "hidden";
    } else {
        btn_next.style.visibility = "visible";
    }
}

function numPages()
{
    return Math.ceil((l - 1) / records_per_page);
}

window.onload = function() {
    changePage(current_page);
};
    










        </script>


        <script src="jquery/jquery-3.7.1.min.js"></script>
        <script src="bootstrap/popper.min.js"></script>
        <script src="bootstrap/bootstrap.min.js"></script>
        <script src="js/index.js"></script>
    
    </body>
</html>
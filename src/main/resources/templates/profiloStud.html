<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generalità Studente</title>
    <link rel="stylesheet" href="/bootstrap/bootstrap.min.css">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: sans-serif;
            background-color: #f8f9fa;
        }
        .container {
            margin: auto;
            width: 1000px;
        }
        nav {
            background: #000;
            padding: 10px 0;
        }
        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: space-between;
        }
        nav ul li {
            margin: 0 15px;
        }
        nav a {
            color: #fff;
            text-decoration: none;
            font-size: 14px;
            padding: 10px;
            border-bottom: 3px solid transparent;
            transition: all .3s ease;
        }
        nav a:hover {
            color: #4caf50;
            border-bottom: 3px solid #4caf50;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #000;
        }
        .form-group .form-control {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            width: 100%;
            box-sizing: border-box;
        }
        .form-control-plaintext {
            background: #e0e0e0;
            border: 1px solid #ddd;
        }
        .hidden {
            display: none;
        }
        .error, .correct {
            display: none;
        }
        .error {
            color: red;
        }
        .correct {
            color: green;
        }
        .btn-group {
            display: flex;
            justify-content: flex-end;
        }
        .btn-group button {
            margin-left: 10px;
        }
        .row {
            display: flex;
            flex-wrap: wrap;
        }
        .col-md-6, .col-md-12 {
            padding: 10px;
        }
        .col-md-6 {
            width: 50%;
        }
        .col-md-12 {
            width: 100%;
        }
        .email-center {
            display: flex;
            justify-content: center;
        }
        .message-box {
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            background: #e0f7e9;
            margin-top: 20px;
        }
        .message-box.hidden {
            display: none;
        }
        .message-box p {
            margin: 0;
            font-size: 14px;
            color: #000;
        }
        .welcome-container {
            background: #e0f7e9;
            border: 2px solid #4caf50;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .welcome-container h3 {
            margin: 0;
            font-size: 24px;
            color: #000;
        }
        .welcome-container p {
            margin: 5px 0 0 0;
            font-size: 16px;
            color: #555;
        }
    </style>
</head>
<body>
    <nav>
        <ul class="container">
            <li><a href='/homeStud/'>Home</a></li>
            <li><a href="/auth/logout" class="btn btn-warning">Logout</a></li>
        </ul>
    </nav>
   
    <div class="container">
        <div class="welcome-container">
            <h3>Benvenuto <span th:text="${session.user.studente.nome}">Nome Utente</span>!</h3>
            <p>Qui potrai visualizzare e modificare i tuoi dati.</p>
        </div>
        <div class="card mt-4">
            <div class="card-header" style="background-color: #000; color: #fff;">
                <h4>Dati Personali:</h4>
            </div>
            <div class="card-body">
                <form id="profilo-form" action="/homeStud/modificaProfilo" method="POST">
                    <div class="row email-center">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="usernameEmail">Username</label>
                                <input type="email" readonly class="form-control form-control-plaintext" name="usernameEmail"
                                    th:value="${session.user.usernameEmail}" required>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="nome">Nome</label>
                                <input type="text" readonly class="form-control form-control-plaintext" name="nome"
                                    th:value="${session.user.studente.nome}" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="cognome">Cognome</label>
                                <input type="text" readonly class="form-control form-control-plaintext" name="cognome"
                                    th:value="${session.user.studente.cognome}" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="dataNascita">Data di Nascita</label>
                                <input type="date" readonly class="form-control form-control-plaintext" id="dataNascita"
                                    name="dataNascita" th:value="${session.user.studente.dataNascita}" required>
                                <i id="error-dataNascita" class="hidden error">La data di nascita non può essere oggi o in futuro</i>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="telefono">Telefono</label>
                                <input id="phone" type="text" readonly class="form-control form-control-plaintext"
                                    name="telefono" maxlength="10" th:value="${session.user.studente.telefono}" required>
                                <i id="error-phone" class="hidden error">Il numero di telefono deve contenere solo cifre e non deve superare i 10 caratteri</i>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="cap">CAP</label>
                                <input id="cap" type="text" readonly class="form-control form-control-plaintext" name="cap"
                                    maxlength="5" th:value="${session.user.studente.cap}" required>
                                <i id="error-cap" class="hidden error">Il CAP deve contenere solo cifre e non deve superare i 5 caratteri</i>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label for="provincia">Provincia</label>
                                <input id="provincia" type="text" readonly class="form-control form-control-plaintext" name="provincia"
                                    maxlength="2" th:value="${session.user.studente.provincia}" required>
                                <i id="error-provincia" class="hidden error">La provincia deve essere composta da esattamente 2 lettere</i>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-md-12">
                            <div class="form-group">
                                <label for="note">Note</label>
                                <textarea id="note" name="note" rows="4" class="form-control"
                                    th:text="${session.user.studente.note}"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12">
                            <div class="message-box" id="message-box">
                                <p><strong>N.B:</strong> Per modificare il profilo e la propria password cliccare su modifica.</p>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 hidden" id="new-pass-group">
                            <div class="form-group">
                                <label for="passkey">Nuova password</label>
                                <input id="passkey" type="password" class="form-control form-control-plaintext"
                                    name="passkey" placeholder="Nuova Password">
                                <i id="error-passkey" class="hidden error">
                                    La password deve contenere: almeno un carattere minuscolo (abc), almeno un carattere
                                    maiuscolo (ABC), almeno un carattere numerico (123)
                                </i>
                                <i id="correct-passkey" class="hidden correct">La password soddisfa i criteri</i>
                            </div>
                        </div>
                        <div class="col-md-6 hidden" id="confirm-pass-group">
                            <div class="form-group">
                                <label for="checkpass">Conferma password</label>
                                <input id="checkpass" type="password" class="form-control form-control-plaintext"
                                    name="checkpass" placeholder="Conferma Password">
                                <i id="error-checkpass" class="hidden error">Le password non corrispondono</i>
                                <i id="correct-checkpass" class="hidden correct">Le password corrispondono</i>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <p class="message-box hidden" id="accept-message">
                                <strong>Attenzione:</strong> Per accettare le modifiche, cliccare su "Salva Modifiche".
                            </p>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button id="btn-mod-profilo" type="button" class="btn btn-outline-primary">Modifica</button>
                        <button id="btn-close-mod" type="button" class="btn btn-outline-danger hidden">Annulla</button>
                        <input id="submit-btn" type="submit" class="btn btn-primary hidden" value="Salva Modifiche" disabled>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="/jquery/jquery-3.7.1.min.js"></script>
    <script src="/bootstrap/popper.min.js"></script>
    <script src="/bootstrap/bootstrap.min.js"></script>
    <script>
        $(document).ready(function () {
            // Nascondi il messaggio di attenzione all'inizio
            $("#accept-message").addClass("hidden");

            // Mostra i campi modificabili e i pulsanti quando si clicca su "Modifica"
            $("#btn-mod-profilo").on("click", function () {
                $("#submit-btn").removeClass("hidden").removeAttr("disabled");
                $("#btn-close-mod").removeClass("hidden");
                $("#btn-mod-profilo").addClass("hidden");
                $("textarea, input.form-control-plaintext").each(function () {
                    $(this).prop("readonly", false);
                    $(this).removeClass("form-control-plaintext").addClass("form-control");
                });
                $("#new-pass-group, #confirm-pass-group").removeClass("hidden");
                $("#message-box").addClass("hidden"); // Nasconde il messaggio N.B.
                $("#accept-message").removeClass("hidden"); // Mostra il messaggio di attenzione
            });

            // Nasconde i campi modificabili e i pulsanti quando si clicca su "Annulla"
            $("#btn-close-mod").on("click", function () {
                $("#submit-btn").addClass("hidden").attr("disabled", "disabled");
                $("#btn-close-mod").addClass("hidden");
                $("#btn-mod-profilo").removeClass("hidden");
                $("textarea, input.form-control").each(function () {
                    $(this).prop("readonly", true);
                    $(this).addClass("form-control-plaintext").removeClass("form-control");
                });
                $("#new-pass-group, #confirm-pass-group").addClass("hidden");
                $("#message-box").removeClass("hidden"); // Mostra il messaggio N.B.
                $("#accept-message").addClass("hidden"); // Nasconde il messaggio di attenzione
            });

            // Controlla che la data di nascita non sia oggi o nel futuro
            $("#dataNascita").on("change", function () {
                var selectedDate = new Date($(this).val());
                var today = new Date();
                today.setHours(0, 0, 0, 0);

                if (selectedDate >= today) {
                    $("#error-dataNascita").removeClass("hidden");
                } else {
                    $("#error-dataNascita").addClass("hidden");
                }
                validateForm();
            });

            // Controlla se il telefono è valido (solo numeri e lunghezza di 10)
            $("#phone").on("input", function () {
                var phone = $(this).val();
                var phonePattern = /^\d{1,10}$/;

                if (!phonePattern.test(phone)) {
                    $("#error-phone").removeClass("hidden");
                } else {
                    $("#error-phone").addClass("hidden");
                }
                validateForm();
            });

            // Controlla se il CAP è valido (solo numeri e lunghezza di 5)
            $("#cap").on("input", function () {
                var cap = $(this).val();
                var capPattern = /^\d{1,5}$/;

                if (!capPattern.test(cap)) {
                    $("#error-cap").removeClass("hidden");
                } else {
                    $("#error-cap").addClass("hidden");
                }
                validateForm();
            });

            // Controlla se la provincia è valida (solo lettere e lunghezza di 2)
            $("#provincia").on("input", function () {
                var provincia = $(this).val();
                var provinciaPattern = /^[A-Za-z]{2}$/;

                if (!provinciaPattern.test(provincia)) {
                    $("#error-provincia").removeClass("hidden");
                } else {
                    $("#error-provincia").addClass("hidden");
                }
                validateForm();
            });

            // Mostra le istruzioni della password quando il campo è attivo
            $("#passkey").on("focus", function () {
                if (!$(this).is("[readonly]")) {
                    $("#error-passkey, #correct-passkey").show();
                }
            }).on("blur", function () {
                $("#error-passkey, #correct-passkey").hide();
            });

            // Confronta le password e mostra il messaggio corrispondente
            $("#passkey, #checkpass").on("keyup", function () {
                var passkey = $("#passkey").val();
                var checkPass = $("#checkpass").val();
                if (checkPass && passkey !== checkPass) {
                    $("#error-checkpass").show();
                    $("#correct-checkpass").hide();
                } else if (checkPass && passkey === checkPass) {
                    $("#error-checkpass").hide();
                    $("#correct-checkpass").show();
                } else {
                    $("#error-checkpass, #correct-checkpass").hide();
                }
                validateForm();
            });

            // Funzione di validazione generale
            function validateForm() {
                var isValid = true;

                // Controlla se ci sono errori di data, telefono, CAP, provincia e password
                if ($("#error-dataNascita").is(":visible") ||
                    $("#error-phone").is(":visible") ||
                    $("#error-cap").is(":visible") ||
                    $("#error-provincia").is(":visible") ||
                    $("#error-checkpass").is(":visible")) {
                    isValid = false;
                }

                // Abilita o disabilita il pulsante di salvataggio
                $("#submit-btn").prop("disabled", !isValid);
            }
        });
    </script>
</body>
</html>

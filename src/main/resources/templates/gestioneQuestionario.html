<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="/css/root.css">
    <link rel="icon" type="image/x-icon" href="/img/logo-ant.ico">
    <title>Gestione Questionario</title>
</head>

<body>

    <nav class="navbar">
        <ul class="navbar__menu">
            <li class="navbar__item">
                <div class="logo"></div>
                <hr>
            </li>
            <li class="navbar__item">
                <a href="/homeAdmin/" class="navbar__link" id="home-link">Home</a>
            </li>
            <li class="navbar__item">
                <a href="/ges_studenti/" class="navbar__link" id="studenti-link">Studenti</a>
            </li>
            <li class="navbar__item">
                <a href="/ges_corsi/" class="navbar__link" id="corsi-link">Corsi</a>
            </li>
            <li class="navbar__item ">
                <a href="/quest/lista" class="navbar__link" id="questionari-link">Questionari</a>
            </li>
            <li class="navbar__item">
                <a href="/quest/esiti" class="navbar__link" id="esiti-link">Esiti</a>
            </li>
            <li class="navbar__item">
                <hr>
                <a href="/auth/logout" class="navbar__link navbar__link--bold">Log Out</a>
            </li>
        </ul>
    </nav>

    <div class="main-content">
        <div class="container">
            <div class="row">
                <div class="col">
                    <div class="card full-width">
                        <div class="card-header">
                            <h5>Impostazioni Test</h5>
                        </div>
                        <div class="card-body p-4">
                            <div class="row d-flex align-items-center">
                                <div class="col-md-4">
                                    <label for="type">Categoria</label>
                                    <select id="type" name="type" style="padding: 10px;">
                                        <option value="" disabled selected> -Selezione un elemento- </option>
                                        <option th:each="categorie : ${listaCategorie}" th:text="${categorie.nome}"
                                            th:value="${categorie.idCat}"
                                            th:selected="${quest.categoriequest.idCat==categorie.idCat}">
                                        </option>
                                    </select>
                                </div>
                                <div class="col-md-4">
                                    <label for="titolo">Titolo</label>
                                    <input id="titolo" name="titolo" type="text" th:value="${quest.titolo}"
                                        style="padding: 10px;">
                                </div>
                                <div class="col-md-3">
                                    <h4 id="quest-attivo">
                                        Stato: <strong th:text="${quest.attivo ? 'Attivo' : 'Non Attivo'}"></strong>
                                    </h4>
                                </div>
                            </div>
                        </div>
                        <div class="card-footer text-end">
                            <button type="button" th:onclick="salvaTest([[${quest.idQst}]])" id="btn_salva_test"
                                class="btn btn-secondary" disabled>Salva</button>
                            <button th:if="${quest.idQst != null}" type="button" class="btn btn-primary"
                                id="btn_attiva_test" data-bs-toggle="modal" data-bs-target="#modale-attiva-test"
                                disabled>
                                Attiva/Disabilita Test
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="spazio-tra-div my-4"></div> <!-- Spacing div -->

            <div class="row">
                <div class="col">
                    <div class="card full-width">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-md-2">
                                    <h5>Elenco domande</h5>
                                </div>
                                <div class=" text-end ">
                                    <button id="btn_aggiungi_domanda" type="button" class="btn btn-secondary"
                                        data-bs-toggle="modal" data-bs-target="#modale-aggiungi-domanda"
                                        th:disabled="${quest.idQst == null}" onclick="firstDomanda()">
                                        <i class="material-icon"></i>
                                        <span>Aggiungi Domanda</span></button>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush" id="elenco-domande">
                                <li class="list-group-item" th:each="domanda : ${quest.domanda}"
                                    th:id=" ${domanda.idQstDet}">
                                    <script>
                                        domanda = new Domanda();
                                        domanda.idQstDet = '[[${domanda.idQstDet}]]';
                                        domanda.domanda = '[[${domanda.domanda}]]';
                                    </script>
                                    <details>
                                        <summary th:id="${domanda.idQstDet}" th:text="${domanda.domanda}"></summary>
                                        <div>
                                            <hr>
                                            <button class="btn btn-outline-primary" data-bs-toggle="modal"
                                                data-bs-target="#modale-modifica-domanda"
                                                onclick="popolaModale(this)">Modifica
                                            </button>
                                            <button class="btn btn-outline-danger" data-bs-toggle="modal"
                                                data-bs-target="#modale-elimina-domanda"
                                                onclick="trovaDomanda(this)">Elimina</button>
                                            <div class="mb-3 mt-3"></div>
                                            <ol class="list-group list-group-numbered">
                                                <th:block th:each="risposta : ${domanda.risp}">
                                                    <script>
                                                        ris = new Risposta();
                                                        ris.idAns = '[[${risposta.idAns}]]';
                                                        ris.risposta = '[[${risposta.risposta}]]';
                                                        ris.corretta = '[[${risposta.corretta}]]';
                                                        domanda.risp.push(ris);
                                                    </script>
                                                    <li th:class="${risposta.corretta} ? 'list-group-item list-group-item-success' : 
                                                'list-group-item list-group-item-danger'"
                                                        th:text="${risposta.risposta}">
                                                    </li>
                                                </th:block>
                                            </ol>
                                        </div>
                                    </details>
                                    <script>
                                        quest.domanda.push(domanda);
                                    </script>
                                </li>
                            </ul>
                        </div>
                        <div class="card-footer text-end">
                            <button type="button" class="btn btn-secondary" id="btn_salva_domanda"
                                onclick="gestisciDomande()" disabled>Salva</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modale Elimina Domanda -->
            <div class="modal fade" tabindex="-1" id="modale-elimina-domanda">
                <div class="modal-dialog modal-dialog-centered ">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Elimina Domanda</h5>
                        </div>
                        <div class="modal-body">
                            <p>Sei sicuro di voler eliminare la domanda?</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary"
                                data-bs-dismiss="modal">Chiudi</button>
                            <button type="button" class="btn btn-danger" onclick="eliminaDomanda()">Elimina</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- FINE Modale Elimina Domanda -->

            <!-- Modale abilita Quest -->
            <div class="modal fade" tabindex="-1" id="modale-attiva-test">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Attiva/Disabilita Test: <strong th:text="${quest.titolo}"></strong>
                            </h5>
                        </div>
                        <div class="modal-body">
                            <p>Sei sicuro di voler Attivare o Disattivare questo Test?</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-secondary"
                                data-bs-dismiss="modal">Chiudi</button>
                            <form action="/quest/attivo" method="post">
                                <input type="hidden" name="idquest" th:value="${quest.idQst}">
                                <button th:if="${!quest.attivo}" type="submit" class="btn btn-success">Attiva</button>
                                <button th:if="${quest.attivo}" type="submit" class="btn btn-danger">Disattiva</button>

                            </form>
                        </div>
                    </div>
                </div>
            </div>
            <!-- FINE Modale abilita Quest -->

            <!--Modale Aggiungi Domanda -->
            <div class="modal fade" id="modale-aggiungi-domanda">
                <div class="modal-dialog modal-dialog-centered modal-xl ">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Aggiungi Domanda</h5>
                            <button type="button" class="close" data-bs-dismiss="modal">x</button>
                        </div>
                        <div class="modal-body">
                            <div class="input-group input-group-sm mb-1">
                                <label class="input-group-text col-5" for="domanda_inserita">
                                    <h5>Domanda</h5>

                                </label>
                                <textarea name="domanda_inserita" class="form-control w-100"
                                    style="text-transform:none;" id="domanda_inserita"></textarea>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-md-6">
                                    <input type="button" class="btn btn-primary custom-btn"
                                        onclick="aggiungiRisposta('nuovo-elenco-risposte')" value="Aggiungi Risposta">
                                </div>
                            </div>
                            <div class="mb-3 mt-3"></div>
                            <div id="nuovo-elenco-risposte">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <div class="d-grid gap-1 col-10 mt-3 mx-auto">
                                <button type="button" class="btn btn-primary" id="btn_add_domanda"
                                    onclick="addDomanda()" disabled>Aggiungi
                                </button>
                            </div>
                            <div class="d-grid gap-2 col-10 mt-2 mx-auto">
                                <button type="button" class="btn btn-secondary"
                                    onclick="pulisicModaleAggiungi()">Pulisci</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--FINE MODALE Aggiungi Domanda -->

            <!-- Modale Modifica Domanda -->
            <div class="modal fade" id="modale-modifica-domanda">
                <div class="modal-dialog modal-dialog-centered modal-xl ">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Modifica Domanda</h5>
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">x</button>
                        </div>
                        <div class="modal-body">
                            <div class="input-group input-group-sm mb-1">
                                <label class="input-group-text col-5" for="domanda_inserita">
                                    <h5>Domanda</h5>
                                </label>
                                <textarea name="domanda_inserita" class="form-control w-100"
                                    style="text-transform:none;" id="domanda_inserita_modifica"></textarea>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-md-6">
                                    <input type="button" class="btn btn-primary btn-sm"
                                        onclick="aggiungiRisposta('elenco-risposte')" value="Aggiungi Risposta">
                                </div>
                            </div>
                            <div class="mb-3 mt-3"></div>
                            <div id="elenco-risposte">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <div class="d-grid gap-1 col-10 mt-3 mx-auto">
                                <button type="button" class="btn btn-primary" id="btn_mod_domanda"
                                    onclick="modDomanda()">Modifica
                                </button>
                            </div>
                            <div class="d-grid gap-2 col-10 mt-2 mx-auto">
                                <button type="button" class="btn btn-warning"
                                    onclick="pulisicDomandeModifica()">Pulisci</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- FINE MODALE Modifica Domanda -->


    <script src="/jquery/jquery-3.7.1.min.js"></script>
    <script src="/bootstrap/popper.min.js"></script>
    <script src="/bootstrap/bootstrap.min.js"></script>
    <script src="/js/bootbox.all.min.js"></script>

    <script src="/js/admin.js"></script>
    <script src="/js/gestQuest.js"></script>
    <script src="/js/objQuest.js"></script>

    <script>
        const quest = new Quest();
        quest.idQst = '[[${ quest.idQst }]]';
        quest.titolo = '[[${ quest.titolo }]]';
        quest.categoria = { idCat: '[[${ quest.categoriequest.idCat }]]', nome: '[[${ quest.categoriequest.nome }]]' };

        let domanda;
        let risposta;
    </script>

</body>

</html>